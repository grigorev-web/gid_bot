# üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥—Å–∫–æ–≥–æ –≥–∏–¥–∞

## üéØ –û–±–∑–æ—Ä

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥—Å–∫–æ–≥–æ –≥–∏–¥–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É Telegram –±–æ—Ç–∞ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- **–ó–∞–≤–µ–¥–µ–Ω–∏—è–º–∏** (—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, –±–∞—Ä—ã, –∫–ª—É–±—ã, –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä—ã, —Ç–µ–∞—Ç—Ä—ã)
- **–°–æ–±—ã—Ç–∏—è–º–∏** (–∫–æ–Ω—Ü–µ—Ä—Ç—ã, –≤–µ—á–µ—Ä–∏–Ω–∫–∏, –≥–æ—Ä–æ–¥—Å–∫–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏)
- **–ê–∫—Ü–∏—è–º–∏ –∏ —Å–∫–∏–¥–∫–∞–º–∏** (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
- **–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏** (–ø–∞—Ä–∫–∏, –º—É–∑–µ–∏, –ø–∞–º—è—Ç–Ω–∏–∫–∏)
- **–ö–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
- **–†–∞–±–æ—á–∏–º–∏ —á–∞—Å–∞–º–∏** –∑–∞–≤–µ–¥–µ–Ω–∏–π

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**: –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- **–ì–∏–±–∫–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Å–≤—è–∑–µ–π
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

### 1. –¢–∞–±–ª–∏—Ü–∞ `addresses` - –ê–¥—Ä–µ—Å–∞

```sql
CREATE TABLE addresses (
    id INT PRIMARY KEY AUTO_INCREMENT,
    street VARCHAR(255) NOT NULL,
    house_number VARCHAR(20) NOT NULL,
    apartment VARCHAR(20),
    city VARCHAR(100) NOT NULL DEFAULT '–ú–æ—Å–∫–≤–∞',
    postal_code VARCHAR(10),
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π —Å–∏—Å—Ç–µ–º—ã
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã), –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è –Ω–∞ –æ–¥–Ω–æ–º –∞–¥—Ä–µ—Å–µ

### 2. –¢–∞–±–ª–∏—Ü–∞ `categories` - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏

```sql
CREATE TABLE categories (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    parent_id INT NULL,
    level INT NOT NULL DEFAULT 1,
    entity_type ENUM('establishment', 'event', 'promotion', 'attraction') NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES categories(id) ON DELETE CASCADE
);
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: 
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `parent_id` –∏ `level`
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º —Å—É—â–Ω–æ—Å—Ç–µ–π
- –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–ü—Ä–∏–º–µ—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π**:
```
–†–µ—Å—Ç–æ—Ä–∞–Ω (level 1)
‚îú‚îÄ‚îÄ –ö–∏—Ç–∞–π—Å–∫–∞—è –∫—É—Ö–Ω—è (level 2)
‚îú‚îÄ‚îÄ –ò—Ç–∞–ª—å—è–Ω—Å–∫–∞—è –∫—É—Ö–Ω—è (level 2)
‚îî‚îÄ‚îÄ –õ—É—á—à–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã (level 2)
```

### 3. –¢–∞–±–ª–∏—Ü–∞ `establishments` - –ó–∞–≤–µ–¥–µ–Ω–∏—è

```sql
CREATE TABLE establishments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    address_id INT NOT NULL,
    phone VARCHAR(20),
    website VARCHAR(255),
    email VARCHAR(255),
    rating DECIMAL(3,2) CHECK (rating >= 0 AND rating <= 5),
    price_range ENUM('budget', 'moderate', 'expensive', 'luxury') DEFAULT 'moderate',
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (address_id) REFERENCES addresses(id) ON DELETE CASCADE
);
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≤–µ–¥–µ–Ω–∏—è—Ö
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: 
- –†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (0-5)
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ü–µ–Ω (–±—é–¥–∂–µ—Ç, —É–º–µ—Ä–µ–Ω–Ω–æ, –¥–æ—Ä–æ–≥–æ, –ª—é–∫—Å)
- –°–≤—è–∑—å —Å –∞–¥—Ä–µ—Å–æ–º (–∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)

### 4. –¢–∞–±–ª–∏—Ü–∞ `working_hours` - –†–∞–±–æ—á–∏–µ —á–∞—Å—ã

```sql
CREATE TABLE working_hours (
    id INT PRIMARY KEY AUTO_INCREMENT,
    establishment_id INT NOT NULL,
    day_of_week INT NOT NULL CHECK (day_of_week >= 1 AND day_of_week <= 7),
    open_time TIME NOT NULL,
    close_time TIME NOT NULL,
    is_24h BOOLEAN DEFAULT FALSE,
    is_closed BOOLEAN DEFAULT FALSE,
    break_start TIME NULL,
    break_end TIME NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (establishment_id) REFERENCES establishments(id) ON DELETE CASCADE,
    UNIQUE KEY unique_day_hours (establishment_id, day_of_week)
);
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏: 1=–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 7=–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
- –ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ –∑–∞–≤–µ–¥–µ–Ω–∏—é –∏ –¥–Ω—é –Ω–µ–¥–µ–ª–∏

### 5. –¢–∞–±–ª–∏—Ü–∞ `events` - –°–æ–±—ã—Ç–∏—è

```sql
CREATE TABLE events (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    event_type ENUM('concert', 'party', 'city_holiday', 'exhibition', 'theater', 'cinema', 'other') NOT NULL,
    start_date DATETIME NOT NULL,
    end_date DATETIME NOT NULL,
    address_id INT NULL,
    establishment_id INT NULL,
    price DECIMAL(10,2),
    max_participants INT,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (address_id) REFERENCES addresses(id) ON DELETE SET NULL,
    FOREIGN KEY (establishment_id) REFERENCES establishments(id) ON DELETE SET NULL,
    CHECK (establishment_id IS NOT NULL OR address_id IS NOT NULL)
);
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–±—ã—Ç–∏—è –∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –∑–∞–≤–µ–¥–µ–Ω–∏—é –ò–õ–ò –∞–¥—Ä–µ—Å—É
- –†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π
- –¶–µ–Ω–æ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–¥–Ω–æ–π –∏–∑ —Å–≤—è–∑–µ–π

### 6. –¢–∞–±–ª–∏—Ü–∞ `promotions` - –ê–∫—Ü–∏–∏ –∏ —Å–∫–∏–¥–∫–∏

```sql
CREATE TABLE promotions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    promotion_type ENUM('discount', 'special_offer', 'happy_hours', 'loyalty_program') NOT NULL,
    discount_percent INT CHECK (discount_percent >= 0 AND discount_percent <= 100),
    discount_amount DECIMAL(10,2),
    start_date DATE,
    end_date DATE,
    valid_days JSON, -- [1,2,3,4,5,6,7] - –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏
    valid_hours JSON, -- {"start": "18:00", "end": "23:00"}
    address_id INT NULL,
    establishment_id INT NULL,
    is_permanent BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (address_id) REFERENCES addresses(id) ON DELETE SET NULL,
    FOREIGN KEY (establishment_id) REFERENCES establishments(id) ON DELETE SET NULL,
    CHECK (establishment_id IS NOT NULL OR address_id IS NOT NULL)
);
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ü–∏–π, —Å–∫–∏–¥–æ–∫ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ –∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫–∏–¥–∫–∏
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–¥–∞—Ç—ã, –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏, —á–∞—Å—ã)
- –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–∫—Ü–∏–∏
- –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –∑–∞–≤–µ–¥–µ–Ω–∏—é –∏–ª–∏ –∞–¥—Ä–µ—Å—É

### 7. –¢–∞–±–ª–∏—Ü–∞ `attractions` - –î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```sql
CREATE TABLE attractions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    attraction_type ENUM('landmark', 'park', 'museum', 'monument', 'viewpoint', 'other') NOT NULL,
    address_id INT NOT NULL,
    rating DECIMAL(3,2) CHECK (rating >= 0 AND rating <= 5),
    is_free BOOLEAN DEFAULT TRUE,
    entry_fee DECIMAL(10,2),
    opening_hours TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (address_id) REFERENCES addresses(id) ON DELETE CASCADE
);
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –º–µ—Å—Ç–∞
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤—Ö–æ–¥–∞
- –†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
- –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

## üîó –°–≤—è–∑—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã

### 8-11. –¢–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–µ–π —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

```sql
-- establishment_categories, event_categories, 
-- promotion_categories, attraction_categories
CREATE TABLE [entity]_categories (
    id INT PRIMARY KEY AUTO_INCREMENT,
    [entity]_id INT NOT NULL,
    category_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY ([entity]_id) REFERENCES [entities](id) ON DELETE CASCADE,
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE CASCADE,
    UNIQUE KEY unique_[entity]_category ([entity]_id, category_id)
);
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–≤—è–∑–∏ –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Å–≤—è–∑–µ–π, –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

## üëÅÔ∏è –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (Views)

### 1. `working_now` - –†–∞–±–æ—Ç–∞—é—â–∏–µ —Å–µ–π—á–∞—Å –∑–∞–≤–µ–¥–µ–Ω–∏—è

```sql
CREATE VIEW working_now AS
SELECT 
    e.id,
    e.name,
    e.description,
    e.address_id,
    wh.close_time,
    TIMEDIFF(wh.close_time, TIME(NOW())) as time_until_close,
    wh.is_24h
FROM establishments e
JOIN working_hours wh ON e.id = wh.establishment_id
WHERE wh.day_of_week = WEEKDAY(NOW()) + 1
  AND wh.is_closed = FALSE
  AND e.is_active = TRUE
  AND (
    wh.is_24h = TRUE 
    OR (
      TIME(NOW()) BETWEEN wh.open_time AND wh.close_time
      AND (wh.break_start IS NULL OR TIME(NOW()) NOT BETWEEN wh.break_start AND wh.break_end)
    )
  );
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –∑–∞–≤–µ–¥–µ–Ω–∏–π, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: ID, –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, –≤—Ä–µ–º—è –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è, –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ—Å—Ç—å

### 2. `active_promotions` - –ê–∫—Ç–∏–≤–Ω—ã–µ –∞–∫—Ü–∏–∏

```sql
CREATE VIEW active_promotions AS
SELECT 
    p.*,
    CASE 
        WHEN p.is_permanent = TRUE THEN TRUE
        WHEN p.start_date IS NULL AND p.end_date IS NULL THEN TRUE
        WHEN CURDATE() BETWEEN p.start_date AND p.end_date THEN TRUE
        ELSE FALSE
    END as is_currently_active
FROM promotions p
WHERE p.is_active = TRUE;
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–∫—Ü–∏–π –ø–æ –¥–∞—Ç–∞–º
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –í—Å–µ –ø–æ–ª—è –∞–∫—Ü–∏–∏ + —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## üìà –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```sql
-- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
CREATE INDEX idx_addresses_coordinates ON addresses(latitude, longitude);
CREATE INDEX idx_addresses_city ON addresses(city);

-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
CREATE INDEX idx_categories_parent_id ON categories(parent_id);
CREATE INDEX idx_categories_entity_type ON categories(entity_type);
CREATE INDEX idx_categories_level ON categories(level);

-- –ó–∞–≤–µ–¥–µ–Ω–∏—è
CREATE INDEX idx_establishments_address_id ON establishments(address_id);
CREATE INDEX idx_establishments_rating ON establishments(rating);
CREATE INDEX idx_establishments_is_active ON establishments(is_active);

-- –°–æ–±—ã—Ç–∏—è
CREATE INDEX idx_events_start_date ON events(start_date);
CREATE INDEX idx_events_end_date ON events(end_date);
CREATE INDEX idx_events_establishment_id ON events(establishment_id);

-- –†–∞–±–æ—á–∏–µ —á–∞—Å—ã
CREATE INDEX idx_working_hours_day_time ON working_hours(day_of_week, open_time, close_time);
CREATE INDEX idx_working_hours_establishment ON working_hours(establishment_id);
```

## üîç –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–µ–∑–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 1. –ù–∞–π—Ç–∏ –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å–µ–π—á–∞—Å –∑–∞–≤–µ–¥–µ–Ω–∏—è

```sql
SELECT 
    e.name,
    e.description,
    a.street,
    a.house_number,
    wh.close_time,
    TIMEDIFF(wh.close_time, TIME(NOW())) as time_until_close
FROM working_now wn
JOIN establishments e ON wn.id = e.id
JOIN addresses a ON e.address_id = a.id
ORDER BY e.name;
```

### 2. –ü–æ–∏—Å–∫ –∑–∞–≤–µ–¥–µ–Ω–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å—é

```sql
WITH RECURSIVE category_tree AS (
    SELECT id, name, parent_id, level
    FROM categories 
    WHERE name = '–†–µ—Å—Ç–æ—Ä–∞–Ω' AND entity_type = 'establishment'
    
    UNION ALL
    
    SELECT c.id, c.name, c.parent_id, c.level
    FROM categories c
    JOIN category_tree ct ON c.parent_id = ct.id
)
SELECT DISTINCT e.name, e.description, c.name as category
FROM establishments e
JOIN establishment_categories ec ON e.id = ec.establishment_id
JOIN category_tree c ON ec.category_id = c.id
WHERE e.is_active = TRUE;
```

### 3. –ê–∫—Ü–∏–∏, –¥–µ–π—Å—Ç–≤—É—é—â–∏–µ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è

```sql
SELECT 
    p.name,
    p.description,
    p.discount_percent,
    e.name as establishment
FROM promotions p
JOIN establishments e ON p.establishment_id = e.id
WHERE p.is_active = TRUE
  AND JSON_CONTAINS(p.valid_days, CAST(WEEKDAY(NOW()) + 1 AS JSON))
  AND JSON_EXTRACT(p.valid_hours, '$.start') <= TIME(NOW())
  AND JSON_EXTRACT(p.valid_hours, '$.end') >= TIME(NOW());
```

### 4. –ü–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º

```sql
SELECT 
    e.name,
    e.description,
    a.street,
    a.house_number,
    ROUND(
        6371 * acos(
            cos(radians(?)) * cos(radians(a.latitude)) * 
            cos(radians(a.longitude) - radians(?)) + 
            sin(radians(?)) * sin(radians(a.latitude))
        ), 2
    ) AS distance_km
FROM establishments e
JOIN addresses a ON e.address_id = a.id
WHERE e.is_active = TRUE
  AND a.latitude IS NOT NULL 
  AND a.longitude IS NOT NULL
HAVING distance_km <= 5
ORDER BY distance_km;
```

### 5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

```sql
SELECT 
    c.name as category,
    COUNT(DISTINCT e.id) as establishments_count,
    AVG(e.rating) as avg_rating,
    COUNT(DISTINCT CASE WHEN e.price_range = 'expensive' THEN e.id END) as expensive_count
FROM categories c
LEFT JOIN establishment_categories ec ON c.id = ec.category_id
LEFT JOIN establishments e ON ec.establishment_id = e.id
WHERE c.entity_type = 'establishment' 
  AND c.level = 1
GROUP BY c.id, c.name
ORDER BY establishments_count DESC;
```

## üöÄ –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
node src/database/migrate.js up

# –û—Ç–∫–∞—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
node src/database/migrate.js down
```

### –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```bash
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
node src/database/seed_city_guide.js
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –í–µ—Ä—Å–∏–∏ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- **MySQL**: 8.0+
- **Node.js**: 16+
- **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: utf8mb4
- **–î–≤–∏–∂–æ–∫**: InnoDB

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –†–µ–π—Ç–∏–Ω–≥–∏: 0-5
- –ü—Ä–æ—Ü–µ–Ω—Ç —Å–∫–∏–¥–∫–∏: 0-100%
- –î–Ω–∏ –Ω–µ–¥–µ–ª–∏: 1-7
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∏ –∞–∫—Ü–∏–π

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è Telegram –±–æ—Ç–∞:
- –°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
- –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

## üîÆ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è:
1. **–û—Ç–∑—ã–≤—ã –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** - —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏** - –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –∑–∞–≤–µ–¥–µ–Ω–∏–π –∏ –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
3. **–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–æ–ª–æ–≤/–±–∏–ª–µ—Ç–æ–≤
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö –∏ –∞–∫—Ü–∏—è—Ö
5. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π –∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π:
1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å—É—â–Ω–æ—Å—Ç–∏
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø –≤ ENUM `entity_type` —Ç–∞–±–ª–∏—Ü—ã `categories`
3. –°–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
4. –î–æ–±–∞–≤–∏—Ç—å –≤ –º–∏–≥—Ä–∞—Ü–∏—é –∏ —Å–∏–¥–µ—Ä

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –≤–æ–ø—Ä–æ—Å—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
2. –£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
4. –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º (`MIGRATION_README.md`)

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –≥–æ—Ä–æ–¥—Å–∫–æ–≥–æ –≥–∏–¥–∞ Telegram –±–æ—Ç–∞*
*–í–µ—Ä—Å–∏—è: 1.0 | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –î–µ–∫–∞–±—Ä—å 2024* 